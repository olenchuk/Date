use Test::More qw(no_plan);
use Date::Range;
use Data::Dumper;
use CodeRyte::DateRange;

my $ref_date = '2016-12-28';

my $crdr = CodeRyte::DateRange->new(today_override => $ref_date);
my $dr = Date::Range->new(today_date => $ref_date);

while (my $line = <main::DATA>) {
    chomp $line;
    my ($intervals,$span,$sliding_window,$direction,
        $year_start,$year_end,$year_last,
        $quarter_start,$quarter_end,$quarter_last,
        $month_start,$month_end,$month_last,
        $day_start,$day_end,$day_last) = split /\s+/, $line;
#next if $intervals;
    $dr->set_intervals($intervals);
    $dr->set_span($span);
    $dr->set_sliding_window($sliding_window);
    $dr->set_direction($direction);
    my $atts = "I=$intervals | S=$span | W=$sliding_window | D=$direction";

    $dr->set_type('year');
    my ($start,$end,$last) = $dr->get_dates;
    cmp_ok($start,'eq',$year_start,"YEAR START $atts") or BAIL_OUT("Fail");
    cmp_ok($end,'eq',$year_end,"YEAR END $atts") or BAIL_OUT("Fail");
    cmp_ok($last,'eq',$year_last,"YEAR LAST $atts") or BAIL_OUT("Fail");

    $dr->set_type('quarter');
    my ($start,$end,$last) = $dr->get_dates;
    cmp_ok($start,'eq',$quarter_start,"QUARTER START $atts") or BAIL_OUT("Fail");
    cmp_ok($end,'eq',$quarter_end,"QUARTER END $atts") or BAIL_OUT("Fail");
    cmp_ok($last,'eq',$quarter_last,"QUARTER LAST $atts") or BAIL_OUT("Fail");

    $dr->set_type('month');
    my ($start,$end,$last) = $dr->get_dates;
    cmp_ok($start,'eq',$month_start,"MONTH START $atts") or BAIL_OUT("Fail");
    cmp_ok($end,'eq',$month_end,"MONTH END $atts") or BAIL_OUT("Fail");
    cmp_ok($last,'eq',$month_last,"MONTH LAST $atts") or BAIL_OUT("Fail");

    $dr->set_type('day');
    my ($start,$end,$last) = $dr->get_dates;
    cmp_ok($start,'eq',$day_start,"DAY START $atts") or BAIL_OUT("Fail");
    cmp_ok($end,'eq',$day_end,"DAY END $atts") or BAIL_OUT("Fail");
    cmp_ok($last,'eq',$day_last,"DAY LAST $atts") or BAIL_OUT("Fail");

}

__END__
-3    1    0    0    2019-01-01    2020-01-01    2019-12-31    2017-07-01    2017-10-01    2017-09-30    2017-03-01    2017-04-01    2017-03-31    2016-12-31    2017-01-01    2016-12-31
-2    1    0    0    2018-01-01    2019-01-01    2018-12-31    2017-04-01    2017-07-01    2017-06-30    2017-02-01    2017-03-01    2017-02-28    2016-12-30    2016-12-31    2016-12-30
-1    1    0    0    2017-01-01    2018-01-01    2017-12-31    2017-01-01    2017-04-01    2017-03-31    2017-01-01    2017-02-01    2017-01-31    2016-12-29    2016-12-30    2016-12-29
0    1    0    0    2016-01-01    2017-01-01    2016-12-31    2016-10-01    2017-01-01    2016-12-31    2016-12-01    2017-01-01    2016-12-31    2016-12-28    2016-12-29    2016-12-28
1    1    0    0    2015-01-01    2016-01-01    2015-12-31    2016-07-01    2016-10-01    2016-09-30    2016-11-01    2016-12-01    2016-11-30    2016-12-27    2016-12-28    2016-12-27
2    1    0    0    2014-01-01    2015-01-01    2014-12-31    2016-04-01    2016-07-01    2016-06-30    2016-10-01    2016-11-01    2016-10-31    2016-12-26    2016-12-27    2016-12-26
3    1    0    0    2013-01-01    2014-01-01    2013-12-31    2016-01-01    2016-04-01    2016-03-31    2016-09-01    2016-10-01    2016-09-30    2016-12-25    2016-12-26    2016-12-25
-3    5    0    0    2031-01-01    2036-01-01    2035-12-31    2020-07-01    2021-10-01    2021-09-30    2018-03-01    2018-08-01    2018-07-31    2017-01-12    2017-01-17    2017-01-16
-2    5    0    0    2026-01-01    2031-01-01    2030-12-31    2019-04-01    2020-07-01    2020-06-30    2017-10-01    2018-03-01    2018-02-28    2017-01-07    2017-01-12    2017-01-11
-1    5    0    0    2021-01-01    2026-01-01    2025-12-31    2018-01-01    2019-04-01    2019-03-31    2017-05-01    2017-10-01    2017-09-30    2017-01-02    2017-01-07    2017-01-06
0    5    0    0    2016-01-01    2021-01-01    2020-12-31    2016-10-01    2018-01-01    2017-12-31    2016-12-01    2017-05-01    2017-04-30    2016-12-28    2017-01-02    2017-01-01
1    5    0    0    2011-01-01    2016-01-01    2015-12-31    2015-07-01    2016-10-01    2016-09-30    2016-07-01    2016-12-01    2016-11-30    2016-12-23    2016-12-28    2016-12-27
2    5    0    0    2006-01-01    2011-01-01    2010-12-31    2014-04-01    2015-07-01    2015-06-30    2016-02-01    2016-07-01    2016-06-30    2016-12-18    2016-12-23    2016-12-22
3    5    0    0    2001-01-01    2006-01-01    2005-12-31    2013-01-01    2014-04-01    2014-03-31    2015-09-01    2016-02-01    2016-01-31    2016-12-13    2016-12-18    2016-12-17
-3    5    1    0    2015-01-01    2020-01-01    2019-12-31    2016-07-01    2017-10-01    2017-09-30    2016-11-01    2017-04-01    2017-03-31    2016-12-27    2017-01-01    2016-12-31
-2    5    1    0    2014-01-01    2019-01-01    2018-12-31    2016-04-01    2017-07-01    2017-06-30    2016-10-01    2017-03-01    2017-02-28    2016-12-26    2016-12-31    2016-12-30
-1    5    1    0    2013-01-01    2018-01-01    2017-12-31    2016-01-01    2017-04-01    2017-03-31    2016-09-01    2017-02-01    2017-01-31    2016-12-25    2016-12-30    2016-12-29
0    5    1    0    2012-01-01    2017-01-01    2016-12-31    2015-10-01    2017-01-01    2016-12-31    2016-08-01    2017-01-01    2016-12-31    2016-12-24    2016-12-29    2016-12-28
1    5    1    0    2011-01-01    2016-01-01    2015-12-31    2015-07-01    2016-10-01    2016-09-30    2016-07-01    2016-12-01    2016-11-30    2016-12-23    2016-12-28    2016-12-27
2    5    1    0    2010-01-01    2015-01-01    2014-12-31    2015-04-01    2016-07-01    2016-06-30    2016-06-01    2016-11-01    2016-10-31    2016-12-22    2016-12-27    2016-12-26
3    5    1    0    2009-01-01    2014-01-01    2013-12-31    2015-01-01    2016-04-01    2016-03-31    2016-05-01    2016-10-01    2016-09-30    2016-12-21    2016-12-26    2016-12-25
